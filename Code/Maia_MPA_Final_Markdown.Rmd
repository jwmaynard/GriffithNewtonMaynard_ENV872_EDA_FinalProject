---
title: "Maia_MPA_Final_Markdown"
author: "Maia Griffith"
date: "2023-11-15"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
here()

MPA.data <- read.csv(here('DataRaw/NOAA_Marine_Protected_Areas_Inventory_2023.csv'),
                     stringsAsFactors = TRUE, 
                     colClasses = c('Year.Established' = 'factor'))

MPA.data.clean <- MPA.data %>%
  select(OBJECTID, Site.Name, State, Level.of.Protection, Management.Plan, Year.Established, Marine.Status, Area..km2., Marine.Area..km2., Percent.Area.Marine, No.Take.Area..km2., Longitude, Latitude) %>% 
  filter(Year.Established != 0)

MPA.data.clean$Year.Established <- as.Date(MPA.data.clean$Year.Established, format = '%Y')

colnames(MPA.data.clean)[8] <- "Area"
colnames(MPA.data.clean)[9] <- "Marine.Area"
colnames(MPA.data.clean)[11] <- "No.Take.Area"
  
Clean.plot <- 
  ggplot(MPA.data.clean) +
  geom_bar(aes(x=Year.Established)) +
  scale_x_date(date_breaks = "2 years", date_labels = "%Y", limits = as.Date(c("2000-11-15", "2023-11-15"))) +
  labs(x = "Year", y = "Count")
print(Clean.plot)


NoTake <- MPA.data.clean %>% 
  filter(No.Take.Area != 0)

PartialNoTake <- NoTake %>% 
  filter(Area != No.Take.Area)

#filter(Marine.Status == Marine)?
```

## Cumulative Number and Total Area Stuff

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Over Time info}

MPA.parks.year <- MPA.data.clean %>%
  mutate("year" = year(Year.Established)) %>%
  group_by(year) %>%
  summarise(count = n()) %>% # Getting the number of parks created per year
  mutate('Cumulative' = cumsum(count)) # Calculating a cumulative sum of the total number of parks per year

# Plot the cumulative sum of NUMBER of MPAs per year to visualize trend over time.
total_num_plot <-
  ggplot(MPA.parks.year) +
  geom_line(aes(x = year,
                y = Cumulative)) +
  labs(title = "Total Number of MPAs Over Time",
       x = "Year",
       y = "Cumulative Number of MPAs")

total_num_plot

# Wrangle data to have the cumulative total area over time.
MPA.totalarea.year <- MPA.data.clean %>%
  mutate("year" = year(Year.Established)) %>%
  arrange(ymd(MPA.data.clean$Year.Established)) %>%
  mutate('Cum_Area' = cumsum(Area))

# Plot the cumulative sum of AREA of MPAs per year to visualize trend over time.
total_area_plot <-
  ggplot(MPA.totalarea.year) +
  geom_line(aes(x = year,
                y = Cum_Area)) +
  labs(title = "Total Area of MPAs Over Time",
       x = "Year",
       y = "Cumulative Area of MPAs")

total_area_plot
```

## T-Test Things

The following code is the data wrangling to create a data frame to use in a two-sided t-test

```{r pressure, echo=FALSE}
# Wrangling the data in order to turn qualitative variables into numeric values.

# Checking the categories of Level of Protection and Management Plan colunms in the df.
levels(MPA.data.clean$Level.of.Protection)
levels(MPA.data.clean$Management.Plan)

# Making a new df to work with for this section
MPA_ttest_df <- MPA.data.clean %>%
  select(OBJECTID, Level.of.Protection, Management.Plan, Year.Established) %>%
  mutate("year" = year(Year.Established))

# Creating a new column with number values assigned to each Level of Protection.
# Range from 1 (lowest level of protection) to 6 (highest level of protection).
# Values/ranking based off metadata information of what each Level allows.
MPA_ttest_df$Level_Val <- as.numeric(ifelse(MPA_ttest_df$Level.of.Protection == "No Access", '6',
                                      ifelse(MPA_ttest_df$Level.of.Protection == "No Impact",'5',
                                      ifelse(MPA_ttest_df$Level.of.Protection == "No Take",'4',
                                      ifelse(MPA_ttest_df$Level.of.Protection == "Uniform Multiple Use",'1',
                                      ifelse(MPA_ttest_df$Level.of.Protection == "Zoned Multiple Use",'2',
                                      ifelse(MPA_ttest_df$Level.of.Protection == "Zoned w/No Take Areas",'3',
                                             '0')))))))

# Do the same thing as above for the Management Plan column.
MPA_ttest_df$Mngmt_Val <- as.numeric(ifelse(MPA_ttest_df$Management.Plan == 
                                              "Community Agreement", '2',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "MPA Management Plan", '6',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "MPA Programmatic Management Plan", '6',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "No Management Plan", '1',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "Non-MPA Programmatic Fisheries Management Plan", '4',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "Non-MPA Programmatic Habitat Management Plan", '5',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "Non-MPA Programmatic Species Management Plan", '3',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "Non-MPA Programmatic Species Management Plan\n", '3',
                                      ifelse(MPA_ttest_df$Management.Plan == 
                                               "Site-Specific Management Plan", '7',
                                             '0'))))))))))

# Make another column for the combined average of the ranking from Level of Protection and Management Plan
MPA_ttest_df$Combo_Val <- rowMeans(MPA_ttest_df[ , c(6,7)], na.rm=TRUE)

# Make another column that separates years into two categories for t-test (pre and post 2000)
MPA_ttest_df$PrePost <- as.factor(ifelse(MPA_ttest_df$year < 2000, 'pre2000','post2000'))

```

Next, perform the two-sample t-test to compare means before and after 2000 for the Level of Protection, Management Plan, and the Combined Average Ranking.

```{r t-test Management, echo=FALSE}
# Two-sample T-test for Level of Protection
# Null: the protection level means are equal; alt: means are not equal)
level.twosample <- t.test(MPA_ttest_df$Level_Val ~ MPA_ttest_df$PrePost)
level.twosample

# Two-sample T-test for Management Plan
# Null: the protection level means are equal; alt: means are not equal)
mngmt.twosample <- t.test(MPA_ttest_df$Mngmt_Val ~ MPA_ttest_df$PrePost)
mngmt.twosample

# Two-sample T-test for Combo of Level of Protection and Management Plan
# Null: the protection level means are equal; alt: means are not equal)
combo.twosample <- t.test(MPA_ttest_df$Combo_Val ~ MPA_ttest_df$PrePost)
combo.twosample

####Do we need/want GLM? Is it even viable in our case?####
# Format as a GLM
level.glm <- lm(MPA_ttest_df$Level_Val ~ MPA_ttest_df$PrePost)
summary(level.glm)
#ask if year is a predictor of Ozone levels to form this equation, shows that year IS a predictor of Ozone levels

```





